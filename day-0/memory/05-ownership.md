# Владение — защита памяти в Rust

[← Куча](04-heap.md) | [Оглавление](README.md) | [Назад к Day 0 →](../README.md)

---

## Проблемы в других языках

### Утечка памяти

Программа берёт память, но не возвращает:

```
[занято][занято][занято][занято]
                          ↑
              память кончилась!
```

### Использование удалённых данных

```
1. Создали    2. Удалили    3. Читаем???

"Привет"  →    мусор    →    ОШИБКА!
```

---

## Три правила Rust

```
┌─────────────────────────────────────────┐
│         ТРИ ПРАВИЛА RUST                │
├─────────────────────────────────────────┤
│                                         │
│  1. У данных есть ХОЗЯИН                │
│                                         │
│  2. Хозяин только ОДИН                  │
│                                         │
│  3. Хозяин "ушёл" = данные удалились    │
│                                         │
└─────────────────────────────────────────┘
```

---

## Пример

```rust
fn main() {
    let s = String::from("привет");  // s — хозяин

    println!("{}", s);

}  // s "ушёл" — строка удалилась автоматически
```

Никаких утечек!

---

## Передача владения

```rust
let a = String::from("привет");
let b = a;  // хозяин теперь b

// println!("{}", a);  // ОШИБКА! a больше не хозяин
println!("{}", b);     // OK
```

```
ДО:                 ПОСЛЕ:
a → "привет"        a (пусто)
                    b → "привет"
```

---

## Одалживание

Можно "одолжить", не забирая:

```rust
let s = String::from("привет");
let len = посчитать(&s);  // &s = одолжить
println!("{}", s);        // s всё ещё доступна!
```

`&` = одолжить, но не забирать.

---

## Результат

| Язык | Утечки | Скорость |
|------|--------|----------|
| C/C++ | Возможны | Быстро |
| Python | Редко | Медленно |
| **Rust** | **Нет** | **Быстро** |

Rust = безопасность + скорость.

---

[← Куча](04-heap.md) | [Оглавление](README.md) | [Назад к Day 0 →](../README.md)
