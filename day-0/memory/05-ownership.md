# Владение (Ownership) — защита памяти в Rust

[← Куча](04-heap.md) | [Оглавление](README.md) | [Назад к Day 0 →](../README.md)

---

## Проблемы в других языках

### Утечка памяти (Memory Leak)

Программа берёт память, но не возвращает:

```
[занято][занято][занято][занято]
                          ↑
              память кончилась!
```

### Использование после освобождения (Use After Free)

```
1. Создали    2. Удалили    3. Читаем???

"Привет"  →    мусор    →    ОШИБКА!
```

### Двойное освобождение (Double Free)

Попытка удалить одни и те же данные дважды — краш программы.

---

## Три правила Rust (Ownership Rules)

```
┌───────────────────────────────────────────────────┐
│          ТРИ ПРАВИЛА ВЛАДЕНИЯ (OWNERSHIP)         │
├───────────────────────────────────────────────────┤
│                                                   │
│  1. У каждого значения есть ВЛАДЕЛЕЦ (owner)      │
│                                                   │
│  2. Владелец может быть только ОДИН               │
│                                                   │
│  3. Когда владелец выходит из области видимости   │
│     (scope) — значение удаляется                  │
│                                                   │
└───────────────────────────────────────────────────┘
```

---

## Пример

```rust
fn main() {
    let s = String::from("привет");  // s — владелец (owner)

    println!("{}", s);

}  // ← s выходит из scope — вызывается drop(), память освобождается
```

> **drop()** — функция, которая автоматически вызывается для освобождения памяти.

> **scope** (область видимости) — часть кода, где переменная существует (обычно между `{` и `}`).

---

## Перемещение (Move)

Когда присваиваешь значение другой переменной — владение **перемещается**:

```rust
let a = String::from("привет");
let b = a;  // MOVE: владение перешло к b

// println!("{}", a);  // ОШИБКА! a больше не владелец
println!("{}", b);     // OK, b — владелец
```

```
ДО (before move):       ПОСЛЕ (after move):

a → "привет"            a (недействителен)
                        b → "привет"
```

> **Move** (перемещение) — передача владения без копирования данных.

---

## Заимствование (Borrowing)

Можно **заимствовать** данные, не забирая владение:

```rust
let s = String::from("привет");
let len = calculate_length(&s);  // &s = ссылка (reference)
println!("{}", s);               // s всё ещё доступна!
```

- `&` — создаёт **ссылку** (reference)
- Ссылка позволяет читать данные, не владея ими
- Владелец остаётся прежним

```
s ──────────────► "привет"
      ↑
      │
&s ───┘  ← ссылка (reference), только смотрит
```

> **Reference** (ссылка) — "указатель" на данные без владения.

> **Borrow** (заимствование) — временное использование данных через ссылку.

---

## Словарь терминов

| Простое | Термин | English | Что делает |
|---------|--------|---------|------------|
| Хозяин | Владелец | Owner | Отвечает за данные |
| Передача | Перемещение | Move | Смена владельца |
| Одолжить | Заимствовать | Borrow | Временный доступ |
| Ссылка | Ссылка | Reference | Указатель без владения |
| Удаление | Освобождение | Drop | Очистка памяти |
| Область видимости | Область видимости | Scope | Где живёт переменная |

---

## Результат

| Язык | Утечки памяти | Скорость |
|------|---------------|----------|
| C/C++ | Возможны | Быстро |
| Python/Java | Редко (GC) | Медленно |
| **Rust** | **Невозможны** | **Быстро** |

> **GC** (Garbage Collector, сборщик мусора) — автоматическая очистка памяти в Python/Java, но замедляет программу.

**Rust = безопасность памяти + скорость C++**

---

[← Куча](04-heap.md) | [Оглавление](README.md) | [Назад к Day 0 →](../README.md)
